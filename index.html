<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Geoportal ‚Äî Instituciones Educativas</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <!-- Leaflet Draw -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

  <!-- Proj4 (DD <-> UTM) -->
  <script src="https://cdn.jsdelivr.net/npm/proj4@2.11.0/dist/proj4.js"></script>

  <!-- (Opcional) Supabase: crea config.js con window.env -->
  <script src="config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header class="app-header">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo" onerror="this.style.display='none'">
      <h1>Geoportal ‚Äî Instituciones Educativas</h1>
    </div>

    <div class="search-row">
      <input id="amieInput" placeholder="Buscar por AMIE o nombre" />
      <button id="searchBtn" class="ghost-btn">Buscar</button>
      <button id="clearFiltersBtn" class="ghost-btn">Limpiar filtros</button>
      <button id="toggleTableBtn" class="btn-accent" title="Mostrar/Ocultar tabla">‚ò∞ Tabla</button>
    </div>
  </header>

  <!-- FILTROS -->
  <section class="filters">
    <select id="provSelect"><option value="">Provincia</option></select>
    <select id="cantSelect"><option value="">Cant√≥n</option></select>
    <select id="parrSelect"><option value="">Parroquia</option></select>
    <select id="sostSelect"><option value="">Sostenimiento</option></select>
    <select id="tipoSelect">
      <option value="">Tipo</option>
      <option value="MATRIZ">MATRIZ</option>
      <option value="ESTABLECIMIENTO">ESTABLECIMIENTO</option>
    </select>
  </section>

  <!-- HERRAMIENTAS + MAPA + TABLA DESLIZABLE -->
  <main class="layout">
    <!-- Calculadora -->
    <aside class="calculator">
      <h2>Calculadora</h2>
      <div class="calc-row">
        <input id="ddInput" placeholder="DD ej: -2.170998, -79.922359">
        <button id="dd2dms" class="ghost-btn">DD ‚Üí DMS</button>
      </div>
      <div class="calc-row">
        <input id="dmsInput" placeholder='DMS ej: 2¬∞10‚Ä≤15‚Ä≥S, 79¬∞55‚Ä≤20‚Ä≥W'>
        <button id="dms2dd" class="ghost-btn">DMS ‚Üí DD</button>
      </div>
      <div class="calc-row">
        <button id="dd2utm" class="ghost-btn">DD ‚Üí UTM 17S</button>
        <span id="utmOut" class="chip"></span>
      </div>
      <hr>
      <div class="tool-row">
        <input id="zoomFree" placeholder="Lat, Lon (acepta , o .)">
        <input id="zoomLevel" type="number" value="15" style="width:90px">
        <button id="zoomGo" class="ghost-btn">Ir</button>
      </div>
      <div class="tool-row">
        <button id="toolDropPoint" class="ghost-btn">üìç Fijar punto</button>
        <button id="toolDrawExtent" class="ghost-btn">‚¨õ Extent</button>
        <button id="toolClearTools" class="ghost-btn">üßπ Limpiar</button>
      </div>
    </aside>

    <!-- Mapa -->
    <section class="map-wrap">
      <div id="map"></div>
      <div id="coordsBar" class="coords-bar">Lat: ‚Äî  Lon: ‚Äî (click para copiar)</div>
    </section>

    <!-- Tabla deslizable -->
    <aside id="tablePanel" class="table-panel collapsed" aria-hidden="true">
      <div class="table-actions">
        <button id="clearSelectionBtn" class="button-ghost">Limpiar selecci√≥n (0)</button>
      </div>

      <div class="table-container">
        <table id="tbl" class="tabla-instituciones">
          <thead>
            <tr>
              <th>AMIE</th>
              <th>Nombre</th>
              <th>Tipo</th>
              <th>Sostenimiento</th>
              <th>Provincia</th>
              <th>Cant√≥n</th>
              <th>Parroquia</th>
            </tr>
          </thead>
          <tbody id="tblBody"><!-- filas din√°micas --></tbody>
        </table>
      </div>

      <div class="pagination">
        <button id="prevPage" class="ghost-btn">‚óÄ</button>
        <span id="pageInfo">P√°gina 1/1</span>
        <button id="nextPage" class="ghost-btn">‚ñ∂</button>
        <select id="pageSize">
          <option value="25" selected>25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
    </aside>
  </main>

  <!-- App -->
  <script src="app.js"></script>
</body>
</html>
